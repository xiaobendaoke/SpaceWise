# æ¶æ„è®¾è®¡æ–‡æ¡£ / Architecture Documentation

[English](#english-version) | ç®€ä½“ä¸­æ–‡

---

## ğŸ“ æ•´ä½“æ¶æ„

äº•äº•é‡‡ç”¨æ ‡å‡†çš„ **MVVMï¼ˆModel-View-ViewModelï¼‰** æ¶æ„æ¨¡å¼ï¼Œç»“åˆ Jetpack Compose å®ç°å£°æ˜å¼ UIã€‚

### æ¶æ„åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   UI Layer (Presentation)                  â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚Locations     â”‚  â”‚FolderBrowser â”‚  â”‚Search        â”‚    â”‚
â”‚  â”‚Screen        â”‚  â”‚Screen        â”‚  â”‚Screen        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚Lists         â”‚  â”‚Settings      â”‚  â”‚Vault         â”‚    â”‚
â”‚  â”‚Screen        â”‚  â”‚Screen        â”‚  â”‚Screen        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ViewModel Layer                         â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚            SpaceViewModel                         â”‚    â”‚
â”‚  â”‚  â€¢ åœºæ‰€/åŒºåŸŸ/ç‰©å“ç®¡ç†                            â”‚    â”‚
â”‚  â”‚  â€¢ æœç´¢ä¸ç­›é€‰                                     â”‚    â”‚
â”‚  â”‚  â€¢ æ¸…å•ç®¡ç†                                       â”‚    â”‚
â”‚  â”‚  â€¢ æ ‡ç­¾ç³»ç»Ÿ                                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚            VaultViewModel                         â”‚    â”‚
â”‚  â”‚  â€¢ ä¿é™©ç®±ç‰©å“ç®¡ç†                                â”‚    â”‚
â”‚  â”‚  â€¢ è®¤è¯çŠ¶æ€ç®¡ç†                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Repository Layer                         â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚AppRepository â”‚  â”‚VaultRepositoryâ”‚                      â”‚
â”‚  â”‚              â”‚  â”‚              â”‚                      â”‚
â”‚  â”‚ â€¢ äº‹åŠ¡ç®¡ç†   â”‚  â”‚ â€¢ ä¿é™©ç®±æ•°æ® â”‚                      â”‚
â”‚  â”‚ â€¢ è·¨è¡¨æ“ä½œ   â”‚  â”‚ â€¢ åŠ å¯†å¤‡ä»½   â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Data Layer                            â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚              AppDatabase (Room)                  â”‚     â”‚
â”‚  â”‚                                                  â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚  â”‚  â”‚Locationâ”‚ â”‚Folder  â”‚ â”‚Item    â”‚ â”‚Tag     â”‚  â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚  â”‚                                                  â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚     â”‚
â”‚  â”‚  â”‚List    â”‚ â”‚ListItemâ”‚ â”‚ItemTag â”‚             â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚            VaultDatabase (Room)                  â”‚     â”‚
â”‚  â”‚                                                  â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚     â”‚
â”‚  â”‚  â”‚VaultItem   â”‚                                 â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—‚ï¸ æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. UI Layerï¼ˆUI å±‚ï¼‰

**æŠ€æœ¯æ ˆ**ï¼šJetpack Compose + Material 3

**èŒè´£**ï¼š
- æ¸²æŸ“ç”¨æˆ·ç•Œé¢
- å¤„ç†ç”¨æˆ·äº¤äº’
- è§‚å¯Ÿ ViewModel çš„çŠ¶æ€å¹¶æ›´æ–° UI

**ä¸»è¦é¡µé¢**ï¼š

| é¡µé¢ | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| åœºæ‰€åˆ—è¡¨ | `LocationsScreen.kt` | å±•ç¤ºæ‰€æœ‰åœºæ‰€ï¼Œä¿é™©ç®±å…¥å£ |
| æ–‡ä»¶å¤¹æµè§ˆå™¨ | `FolderBrowserScreen.kt` | å¤šå±‚çº§åŒºåŸŸä¸ç‰©å“æµè§ˆ |
| æœç´¢é¡µé¢ | `SearchScreen.kt` | å…¨å±€æœç´¢ä¸ç­›é€‰ |
| æ¸…å•ç®¡ç† | `ListsScreens.kt` | æ¸…å•åˆ—è¡¨ä¸è¯¦æƒ… |
| è®¾ç½®é¡µé¢ | `SettingsScreen.kt` | åº”ç”¨è®¾ç½®ä¸æ•°æ®ç®¡ç† |
| ä¿é™©ç®± | `VaultScreen.kt` | åŠ å¯†ç‰©å“å­˜å‚¨ |
| å¼•å¯¼é¡µ | `OnboardingScreen.kt` | é¦–æ¬¡ä½¿ç”¨å¼•å¯¼ |

**è®¾è®¡æ¨¡å¼**ï¼š
- **çŠ¶æ€æå‡**ï¼šæ‰€æœ‰çŠ¶æ€ç”± ViewModel ç®¡ç†
- **å•å‘æ•°æ®æµ**ï¼šæ•°æ®ä» ViewModel â†’ UIï¼Œäº‹ä»¶ä» UI â†’ ViewModel
- **ç»„åˆä¼˜å…ˆ**ï¼šå¯å¤ç”¨çš„å°å‹ Composable å‡½æ•°

---

### 2. ViewModel Layerï¼ˆè§†å›¾æ¨¡å‹å±‚ï¼‰

**æŠ€æœ¯æ ˆ**ï¼šJetpack ViewModel + Kotlin Coroutines + Flow

**æ ¸å¿ƒç±»**ï¼š

#### SpaceViewModel
ä¸»è¦çš„ä¸šåŠ¡é€»è¾‘å¤„ç†ç±»ï¼Œåè°ƒæ‰€æœ‰æ•°æ®æ“ä½œã€‚

**ä¸»è¦èŒè´£**ï¼š
- åœºæ‰€ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
- åŒºåŸŸç®¡ç†ï¼ˆæ— é™å±‚çº§åµŒå¥—ï¼‰
- ç‰©å“ç®¡ç†ï¼ˆç…§ç‰‡ã€æ ‡ç­¾ã€è¿‡æœŸæ—¥æœŸï¼‰
- æœç´¢ä¸ç­›é€‰
- æ¸…å•ç®¡ç†
- æ ‡ç­¾ç³»ç»Ÿ
- å›¾ç‰‡å­˜å‚¨

**å…³é”®æ–¹æ³•**ï¼š

```kotlin
// åœºæ‰€ç®¡ç†
suspend fun addLocation(name: String, icon: String?, coverImagePath: String?)
suspend fun updateLocation(locationId: String, ...)
suspend fun removeLocation(locationId: String)

// åŒºåŸŸç®¡ç†
suspend fun addFolder(locationId: String, parentId: String?, ...)
suspend fun updateFolder(folderId: String, ...)
suspend fun removeFolder(folderId: String)

// ç‰©å“ç®¡ç†
suspend fun addItemToFolder(folderId: String, itemName: String, ...)
suspend fun updateItemFull(itemId: String, ...)
suspend fun removeItem(itemId: String)

// æœç´¢
fun observeSearchResults(...): Flow<List<SearchResult>>
```

#### VaultViewModel
ä¿é™©ç®±ä¸“ç”¨çš„ ViewModelã€‚

**ä¸»è¦èŒè´£**ï¼š
- ç‹¬ç«‹çš„è®¤è¯çŠ¶æ€ç®¡ç†
- åŠ å¯†ç‰©å“çš„ CRUD
- æ•°æ®å¯¼å‡ºä¸å¯¼å…¥

---

### 3. Repository Layerï¼ˆä»“åº“å±‚ï¼‰

**èŒè´£**ï¼š
- å°è£…å¤æ‚çš„è·¨è¡¨æ“ä½œ
- æä¾›äº‹åŠ¡æ”¯æŒ
- éš”ç¦»æ•°æ®å±‚å®ç°ç»†èŠ‚

**AppRepository**ï¼š
```kotlin
class AppRepository(private val db: AppDatabase) {
    // äº‹åŠ¡æ€§æ›´æ–°ç‰©å“æ ‡ç­¾
    suspend fun setTagsForItem(itemId: String, tagIds: List<String>)
    
    // æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼ˆé‡ç½®åº”ç”¨ï¼‰
    suspend fun wipeAllData()
}
```

**VaultRepository**ï¼š
```kotlin
class VaultRepository(private val db: VaultDatabase) {
    // ä¿é™©ç®±ç‰©å“æ“ä½œ
    suspend fun addVaultItem(...)
    suspend fun exportVaultData(): String
}
```

---

### 4. Data Layerï¼ˆæ•°æ®å±‚ï¼‰

**æŠ€æœ¯æ ˆ**ï¼šRoom Database (SQLite)

#### æ•°æ®åº“ç»“æ„

**ä¸»æ•°æ®åº“ï¼ˆAppDatabaseï¼‰**ï¼š

```sql
-- åœºæ‰€è¡¨
locations
â”œâ”€â”€ id (PK)
â”œâ”€â”€ name
â”œâ”€â”€ icon
â”œâ”€â”€ coverImagePath
â””â”€â”€ ...

-- åŒºåŸŸè¡¨ï¼ˆæ”¯æŒè‡ªå…³è”ï¼‰
folders
â”œâ”€â”€ id (PK)
â”œâ”€â”€ locationId (FK -> locations.id)
â”œâ”€â”€ parentId (FK -> folders.id, nullable)
â”œâ”€â”€ name
â”œâ”€â”€ enableMapView
â”œâ”€â”€ mapX, mapY
â””â”€â”€ ...

-- ç‰©å“è¡¨
items
â”œâ”€â”€ id (PK)
â”œâ”€â”€ folderId (FK -> folders.id)
â”œâ”€â”€ name
â”œâ”€â”€ imagePath
â”œâ”€â”€ expiryDateEpochMs
â”œâ”€â”€ currentQuantity
â”œâ”€â”€ minQuantity
â””â”€â”€ ...

-- æ ‡ç­¾è¡¨ï¼ˆæ”¯æŒå±‚çº§ï¼‰
tags
â”œâ”€â”€ id (PK)
â”œâ”€â”€ name
â”œâ”€â”€ parentId (FK -> tags.id, nullable)
â””â”€â”€ ...

-- ç‰©å“-æ ‡ç­¾å…³è”è¡¨ï¼ˆå¤šå¯¹å¤šï¼‰
item_tags
â”œâ”€â”€ itemId (FK -> items.id)
â””â”€â”€ tagId (FK -> tags.id)

-- æ¸…å•è¡¨
lists
â”œâ”€â”€ id (PK)
â”œâ”€â”€ name
â””â”€â”€ ...

-- æ¸…å•æ¡ç›®è¡¨
list_items
â”œâ”€â”€ id (PK)
â”œâ”€â”€ listId (FK -> lists.id)
â”œâ”€â”€ name
â”œâ”€â”€ checked
â”œâ”€â”€ linkedItemId (FK -> items.id, nullable)
â””â”€â”€ ...
```

**ä¿é™©ç®±æ•°æ®åº“ï¼ˆVaultDatabaseï¼‰**ï¼š

```sql
-- ä¿é™©ç®±ç‰©å“è¡¨
vault_items
â”œâ”€â”€ id (PK)
â”œâ”€â”€ name
â”œâ”€â”€ note
â”œâ”€â”€ imagePath
â””â”€â”€ ...
```

#### çº§è”åˆ é™¤ç­–ç•¥

```
åˆ é™¤åœºæ‰€ â†’ è‡ªåŠ¨åˆ é™¤å…¶ä¸‹æ‰€æœ‰åŒºåŸŸ â†’ è‡ªåŠ¨åˆ é™¤æ‰€æœ‰ç‰©å“ â†’ è‡ªåŠ¨åˆ é™¤ç‰©å“æ ‡ç­¾å…³è”

åˆ é™¤åŒºåŸŸ â†’ è‡ªåŠ¨åˆ é™¤å…¶ä¸‹æ‰€æœ‰å­åŒºåŸŸå’Œç‰©å“

åˆ é™¤ç‰©å“ â†’ è‡ªåŠ¨åˆ é™¤ç‰©å“æ ‡ç­¾å…³è”

åˆ é™¤æ ‡ç­¾ â†’ è‡ªåŠ¨åˆ é™¤ç‰©å“æ ‡ç­¾å…³è”
```

---

## ğŸ”Œ è¾…åŠ©æ¨¡å—

### å›¾ç‰‡å­˜å‚¨ï¼ˆInternalImageStoreï¼‰

**èŒè´£**ï¼š
- å°†ç”¨æˆ·ä¸Šä¼ /æ‹æ‘„çš„å›¾ç‰‡ä¿å­˜åˆ°å†…éƒ¨å­˜å‚¨
- ç”Ÿæˆå”¯ä¸€æ–‡ä»¶åï¼ˆUUIDï¼‰
- å¤„ç†ä¸åŒæ¥æºçš„å›¾ç‰‡ï¼ˆç›¸æœºã€ç›¸å†Œã€Bitmapï¼‰

**å­˜å‚¨ä½ç½®**ï¼š`/data/data/com.example.myapplication/files/images/`

**å…³é”®æ–¹æ³•**ï¼š
```kotlin
fun persistFromUri(context: Context, sourceUri: Uri): String?
fun persistBitmap(context: Context, bitmap: Bitmap): String?
fun delete(context: Context, path: String): Boolean
```

---

### OCR è¯†åˆ«ï¼ˆOcrRecognizerï¼‰

**æŠ€æœ¯æ ˆ**ï¼šGoogle ML Kit Text Recognition (Chinese)

**èŒè´£**ï¼š
- ä»å›¾ç‰‡ä¸­è¯†åˆ«ä¸­æ–‡æ–‡å­—
- ç”¨äºç‰©å“ç…§ç‰‡çš„æ™ºèƒ½å‘½å

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```kotlin
val text = OcrRecognizer.recognizeFromInternalPath(context, imagePath)
if (text != null) {
    // å°†è¯†åˆ«ç»“æœå¡«å……åˆ°ç‰©å“åç§°
}
```

---

### å¤‡ä»½ç®¡ç†ï¼ˆBackupManagerï¼‰

**èŒè´£**ï¼š
- å¯¼å‡ºæ•°æ®åº“ä¸º JSON
- ä» JSON æ¢å¤æ•°æ®

**å¤‡ä»½å†…å®¹**ï¼š
- æ‰€æœ‰åœºæ‰€ã€åŒºåŸŸã€ç‰©å“
- æ ‡ç­¾å’Œæ¸…å•
- ä¸åŒ…å«å›¾ç‰‡æ–‡ä»¶ï¼ˆä»…è·¯å¾„å¼•ç”¨ï¼‰

---

### åå°ä»»åŠ¡ï¼ˆWorkManagerï¼‰

**ExpiryCheckWorker**ï¼š
- å®šæœŸæ£€æŸ¥å³å°†è¿‡æœŸçš„ç‰©å“
- å‘é€ç³»ç»Ÿé€šçŸ¥æé†’

**è°ƒåº¦ç­–ç•¥**ï¼š
- æ¯æ—¥è¿è¡Œä¸€æ¬¡
- ç½‘ç»œæ— å…³ï¼ˆç¦»çº¿å¯ç”¨ï¼‰

---

### è®¾ç½®å­˜å‚¨ï¼ˆSettingsRepositoryï¼‰

**æŠ€æœ¯æ ˆ**ï¼šDataStore (Preferences)

**å­˜å‚¨å†…å®¹**ï¼š
```kotlin
data class UserSettings(
    val hasSeenOnboarding: Boolean = false,
    val notificationsEnabled: Boolean = true,
    val theme: String = "system"
)
```

---

## ğŸ”’ ä¿é™©ç®±æ¶æ„

### æ•°æ®éš”ç¦»

- **ç‹¬ç«‹æ•°æ®åº“**ï¼š`VaultDatabase` å®Œå…¨ç‹¬ç«‹äº `AppDatabase`
- **ç‹¬ç«‹ ViewModel**ï¼š`VaultViewModel` ä¸ä¾èµ– `SpaceViewModel`
- **ç‰©ç†éš”ç¦»**ï¼šæ•°æ®åº“æ–‡ä»¶åˆ†å¼€å­˜å‚¨

### å®‰å…¨æœºåˆ¶

1. **ç”Ÿç‰©è¯†åˆ«è®¤è¯**ï¼š
   - ä½¿ç”¨ `androidx.biometric.BiometricPrompt`
   - æ”¯æŒæŒ‡çº¹ã€é¢éƒ¨è¯†åˆ«
   - é™çº§åˆ° PIN/å¯†ç 

2. **ä¸´æ—¶è®¤è¯çŠ¶æ€**ï¼š
   - è®¤è¯å 5 åˆ†é’Ÿå†…æœ‰æ•ˆ
   - ç¦»å¼€åº”ç”¨è‡ªåŠ¨æ¸…é™¤çŠ¶æ€
   - ä¸æŒä¹…åŒ–è®¤è¯çŠ¶æ€

3. **åŠ å¯†å­˜å‚¨**ï¼ˆæœªæ¥è®¡åˆ’ï¼‰ï¼š
   - ä½¿ç”¨ `androidx.security.crypto` åŠ å¯†æ•°æ®åº“
   - å¯†é’¥å­˜å‚¨åœ¨ Android Keystore

---

## ğŸ“Š æ•°æ®æµç¤ºä¾‹

### æ·»åŠ ç‰©å“æµç¨‹

```
1. ç”¨æˆ·åœ¨ FolderBrowserScreen ç‚¹å‡»"æ·»åŠ ç‰©å“"
   â†“
2. æ‰“å¼€ ItemUpsertDialogï¼ˆCompose å¯¹è¯æ¡†ï¼‰
   â†“
3. ç”¨æˆ·è¾“å…¥åç§°ã€æ‹ç…§ã€é€‰æ‹©æ ‡ç­¾
   â†“
4. ç”¨æˆ·ç‚¹å‡»"ä¿å­˜"
   â†“
5. è°ƒç”¨ viewModel.addItemToFolder(...)
   â†“
6. ViewModel å†…éƒ¨è°ƒç”¨ï¼š
   - InternalImageStore.persistFromUri(...) ä¿å­˜å›¾ç‰‡
   - dao.insertItem(...) å†™å…¥æ•°æ®åº“
   - dao.addItemTags(...) å†™å…¥æ ‡ç­¾å…³è”
   â†“
7. Room é€šè¿‡ Flow è‡ªåŠ¨é€šçŸ¥ UI æ›´æ–°
   â†“
8. FolderBrowserScreen é‡æ–°ç»„åˆï¼Œæ˜¾ç¤ºæ–°ç‰©å“
```

### æœç´¢æµç¨‹

```
1. ç”¨æˆ·åœ¨ SearchScreen è¾“å…¥æŸ¥è¯¢
   â†“
2. è°ƒç”¨ viewModel.observeSearchResults(query, ...)
   â†“
3. ViewModel ä½¿ç”¨ Flow æ“ä½œç¬¦ç»„åˆæŸ¥è¯¢æ¡ä»¶
   â†“
4. Room DAO æ‰§è¡Œ SQL æŸ¥è¯¢ï¼š
   SELECT items.*, folders.name, locations.name
   FROM items
   JOIN folders ON items.folderId = folders.id
   JOIN locations ON folders.locationId = locations.id
   WHERE items.name LIKE '%query%'
   OR items.note LIKE '%query%'
   â†“
5. ç»“æœé€šè¿‡ Flow è¿”å›
   â†“
6. UI è‡ªåŠ¨æ›´æ–°æ˜¾ç¤ºæœç´¢ç»“æœ
```

---

## ğŸ¨ UI è®¾è®¡åŸåˆ™

### Material 3 å®ç°

- **åŠ¨æ€é…è‰²**ï¼šæ”¯æŒ Material Youï¼ˆAndroid 12+ï¼‰
- **ç»„ä»¶**ï¼šä½¿ç”¨å®˜æ–¹ Material 3 ç»„ä»¶
- **ä¸»é¢˜**ï¼šæµ…è‰²/æ·±è‰²ä¸»é¢˜è‡ªåŠ¨åˆ‡æ¢

### å¯¼èˆªç»“æ„

```
MainActivity
â””â”€â”€ NavHost
    â”œâ”€â”€ locations (é¦–é¡µ)
    â”œâ”€â”€ folder_browser/{locationId}
    â”œâ”€â”€ folder_browser/{locationId}/{folderId}
    â”œâ”€â”€ search
    â”œâ”€â”€ lists
    â”œâ”€â”€ list_detail/{listId}
    â”œâ”€â”€ settings
    â”œâ”€â”€ onboarding
    â””â”€â”€ vault
```

### çŠ¶æ€ç®¡ç†

- **ViewModel çŠ¶æ€**ï¼šä½¿ç”¨ `StateFlow` å’Œ `Flow`
- **Compose æœ¬åœ°çŠ¶æ€**ï¼šä½¿ç”¨ `remember` å’Œ `mutableStateOf`
- **åŸåˆ™**ï¼šèƒ½åœ¨ Compose å†…ç®¡ç†çš„å°±ä¸æå‡åˆ° ViewModel

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–

1. **ç´¢å¼•**ï¼š
   - å¤–é”®å­—æ®µï¼ˆlocationId, folderId, parentIdï¼‰
   - æŸ¥è¯¢å­—æ®µï¼ˆexpiryDateEpochMsï¼‰

2. **åˆ†é¡µ**ï¼ˆæœªæ¥è®¡åˆ’ï¼‰ï¼š
   - ä½¿ç”¨ Paging 3 åº“
   - æ‡’åŠ è½½å¤§é‡ç‰©å“

### UI ä¼˜åŒ–

1. **LazyColumn/LazyGrid**ï¼š
   - åˆ—è¡¨ä½¿ç”¨ Lazy ç»„ä»¶
   - ä»…æ¸²æŸ“å¯è§é¡¹

2. **å›¾ç‰‡åŠ è½½**ï¼š
   - å¼‚æ­¥åŠ è½½
   - ç¼©ç•¥å›¾æ˜¾ç¤º

---

## ğŸ”„ æœªæ¥æ”¹è¿›æ–¹å‘

1. **å¤šè¯­è¨€æ”¯æŒ**ï¼š
   - ä½¿ç”¨ `strings.xml` èµ„æº
   - æ”¯æŒè‹±æ–‡ã€æ—¥æ–‡ç­‰

2. **äº‘åŒæ­¥**ï¼ˆå¯é€‰ï¼‰ï¼š
   - Firebase/è‡ªå»ºæœåŠ¡å™¨
   - ç«¯åˆ°ç«¯åŠ å¯†

3. **ç»Ÿè®¡åˆ†æ**ï¼š
   - ç‰©å“ä½¿ç”¨é¢‘ç‡
   - è¿‡æœŸç‰©å“è¶‹åŠ¿

4. **AI æ¨è**ï¼š
   - æ™ºèƒ½åˆ†ç±»å»ºè®®
   - è‡ªåŠ¨æ ‡ç­¾æ¨è

---

## English Version

# Architecture Documentation

English | [ç®€ä½“ä¸­æ–‡](#æ¶æ„è®¾è®¡æ–‡æ¡£--architecture-documentation)

## ğŸ“ Overall Architecture

JingJing follows the standard **MVVM (Model-View-ViewModel)** architecture pattern with Jetpack Compose for declarative UI.

### Architecture Layers

```
UI Layer (Compose Screens)
    â†“
ViewModel Layer (Business Logic)
    â†“
Repository Layer (Data Operations)
    â†“
Data Layer (Room Database)
```

## ğŸ—‚ï¸ Core Modules

### 1. UI Layer
- **Tech**: Jetpack Compose + Material 3
- **Screens**: Locations, FolderBrowser, Search, Lists, Settings, Vault

### 2. ViewModel Layer
- **SpaceViewModel**: Main business logic
- **VaultViewModel**: Vault-specific logic

### 3. Repository Layer
- **AppRepository**: Transaction management
- **VaultRepository**: Encrypted vault operations

### 4. Data Layer
- **AppDatabase**: Main database (Locations, Folders, Items, Tags, Lists)
- **VaultDatabase**: Isolated vault storage

## ğŸ”Œ Supporting Modules

- **InternalImageStore**: Image persistence
- **OcrRecognizer**: ML Kit text recognition
- **BackupManager**: Data export/import
- **WorkManager**: Background tasks (expiry notifications)
- **SettingsRepository**: User preferences (DataStore)

## ğŸ”’ Vault Security

- **Isolated Database**: Separate from main app
- **Biometric Auth**: Fingerprint/Face ID
- **Temporary Auth**: 5-minute session timeout

---

<div align="center">

For more details, refer to the source code documentation.

</div>
